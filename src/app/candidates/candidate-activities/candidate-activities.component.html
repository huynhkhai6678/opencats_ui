@let contactList = activities.value() || [];

<div class="flex direction-end mt-2 justify-end">
    <p-button label="Log an Activity" class="me-2" (onClick)="create()"/>
</div>

<div class="mt-4">
    <p-table
        [value]="contactList"
        [lazy]="false"
        [paginator]="false"
        [rowsPerPageOptions]="[10, 20, 50]"
    >
        <ng-template pTemplate="header">
            <tr>
                <th pSortableColumn="date_created">
                    <div class="flex items-center gap-2">
                        Date
                        <p-sortIcon field="date_created"></p-sortIcon>
                    </div>
                </th>
                <th pSortableColumn="type_info.short_description">
                    <div class="flex items-center gap-2">
                        Type
                        <p-sortIcon field="type_info.short_description"></p-sortIcon>
                    </div>
                </th>
                <th pSortableColumn="entered_user.first_name">
                    <div class="flex items-center gap-2">
                        Entered
                        <p-sortIcon field="entered_user.first_name"></p-sortIcon>
                    </div>
                </th>
                <th pSortableColumn="joborder.title">
                    <div class="flex items-center gap-2">
                        Regarding
                        <p-sortIcon field="joborder.title"></p-sortIcon>
                    </div>
                </th>
                <th pSortableColumn="notes">
                    <div class="flex items-center gap-2">
                        Notes
                        <p-sortIcon field="notes"></p-sortIcon>
                    </div>
                </th>
                <th >
                    <div class="flex items-center gap-2">
                        Action
                    </div>
                </th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-row>
            <tr>
                <td>
                    {{ row.date_created | date : "dd/MM/yyyy (hh:mm a)" }}
                </td>
                <td>
                    {{ row.type_info.short_description }}
                </td>
                <td>
                    {{row.entered_user?.first_name}} {{row.entered_user?.last_name}}
                </td>
                <td>
                    @if (row.joborder) {
                        {{row.joborder.title}} ({{row.joborder.company?.name}})
                    } @else {
                        General
                    }
                </td>
                <td>
                    <div [innerHTML]="row.notes | safeHtml"></div>
                </td>
                <td>
                    <div class="flex gap-2">
                        <p-button severity="info" (onClick)="edit(row.activity_id)">
                            <fa-icon [icon]="faPencil"></fa-icon>
                        </p-button>
                        <p-button severity="danger" (onClick)="deleteItem($event, row.activity_id)">
                            <fa-icon [icon]="faTrash"></fa-icon>
                        </p-button>
                    </div>
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>

<app-activity-modal  #activityModal (reloadTable)="reloadData()"></app-activity-modal>